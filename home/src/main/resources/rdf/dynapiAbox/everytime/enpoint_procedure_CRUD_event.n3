@prefix rdf:  			<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:  			<http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:   			<http://www.w3.org/2002/07/owl#> .
@prefix vitro: 			<http://vitro.mannlib.cornell.edu/ns/vitro/0.7#> .
@prefix dynapi: 		<https://vivoweb.org/ontology/vitro-dynamic-api#> .
@prefix dynapi_java: 	        <java:edu.cornell.mannlib.vitro.webapp.dynapi.components#> .
@prefix xsd: 			<http://www.w3.org/2001/XMLSchema#> .

###############################################
### N3 TEMPLATE PARTIAL ENTITY CREATION
###############################################

<https://vivoweb.org/procedure/create_event/execute_template/n3_template_subject>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/uri> ;
        dynapi:N3TextAdditions   		
        """
                ?uri <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://purl.org/NET/c4dm/event.owl#Event> ;
        """ .

<https://vivoweb.org/procedure/create_event/execute_template/n3_template_type>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event type N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/uri> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/type> ;
        dynapi:N3TextAdditions   		"?uri <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#mostSpecificType> ?type . " .

<https://vivoweb.org/procedure/create_event/execute_template/n3_template_name>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event name N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/uri> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/name> ;
        dynapi:N3TextAdditions   		"?uri <http://www.w3.org/2006/vcard/ns#Name> ?name . " .

<https://vivoweb.org/procedure/create_event/execute_template/n3_template_abbreviation>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event abbreviation N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/uri> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/abbreviation> ;
        dynapi:N3TextAdditions   		"?uri <http://vivoweb.org/ontology/core#abbreviation> ?abbreviation . " .

<https://vivoweb.org/procedure/create_event/execute_template/n3_template_startDate>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event startDate N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/uri> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/startDate> ;
        dynapi:N3TextAdditions   		"?uri <http://vivoweb.org/ontology/core#start> ?startDate . " .

<https://vivoweb.org/procedure/create_event/execute_template/n3_template_endDate>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event endDate N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/uri> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/endDate> ;
        dynapi:N3TextAdditions   		"?uri <http://vivoweb.org/ontology/core#end> ?endDate . " .

<https://vivoweb.org/procedure/create_event/execute_template/n3_template_place>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event place N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/uri> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/place> ;
        dynapi:N3TextAdditions   		"?uri <http://www.w3.org/2006/vcard/ns#Address> ?place . " .

<https://vivoweb.org/procedure/create_event/event_venue_construct_query_fill_in/operation>
        a                                       dynapi:N3Template ;
        dynapi:hasModel                         <https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/venueName> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/venueURI> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/uri> ;
        dynapi:N3TextAdditions              
        """
        @prefix dynapi: <https://vivoweb.org/ontology/vitro-dynamic-api#> .
        @prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
        
        ?venueURI <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2006/vcard/ns#Individual> ;
                <http://www.w3.org/2006/vcard/ns#Name> ?venueName .
        
        ?uri <http://vivoweb.org/ontology/core#hasPublicationVenue> ?venueURI .
        """ .

###############################################
### N3 TEMPLATE PARTIAL ENTITY UPDATE
###############################################

<https://vivoweb.org/procedure/update_event/execute_template/n3_template_subject>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:N3TextAdditions   		
        """
                ?resource_id <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://purl.org/NET/c4dm/event.owl#Event> ;
        """ .

<https://vivoweb.org/procedure/update_event/execute_template/n3_template_type>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event type N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/type> ;
        dynapi:N3TextAdditions   		"?resource_id <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#mostSpecificType> ?type . " .

<https://vivoweb.org/procedure/update_event/execute_template/n3_template_name>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event name N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/name> ;
        dynapi:N3TextAdditions   		"?resource_id <http://www.w3.org/2006/vcard/ns#Name> ?name . " .

<https://vivoweb.org/procedure/update_event/execute_template/n3_template_abbreviation>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event abbreviation N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/abbreviation> ;
        dynapi:N3TextAdditions   		"?resource_id <http://vivoweb.org/ontology/core#abbreviation> ?abbreviation . " .

<https://vivoweb.org/procedure/update_event/execute_template/n3_template_startDate>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event startDate N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/startDate> ;
        dynapi:N3TextAdditions   		"?resource_id <http://vivoweb.org/ontology/core#start> ?startDate . " .

<https://vivoweb.org/procedure/update_event/execute_template/n3_template_endDate>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event endDate N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/endDate> ;
        dynapi:N3TextAdditions   		"?resource_id <http://vivoweb.org/ontology/core#end> ?endDate . " .

<https://vivoweb.org/procedure/update_event/execute_template/n3_template_place>
        a                        		dynapi:N3Template ;
        rdfs:label               		"create event place N3 Template"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter 		<https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/place> ;
        dynapi:N3TextAdditions   		"?resource_id <http://www.w3.org/2006/vcard/ns#Address> ?place . " .

<https://vivoweb.org/procedure/update_event/event_venue_construct_query_fill_in/operation>
        a                                       dynapi:N3Template ;
        dynapi:hasModel                         <https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/venueName> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/venueURI> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:N3TextAdditions              
        """
        @prefix dynapi: <https://vivoweb.org/ontology/vitro-dynamic-api#> .
        @prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
        
        ?venueURI <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2006/vcard/ns#Individual> ;
                <http://www.w3.org/2006/vcard/ns#Name> ?venueName .
        
        ?resource_id <http://vivoweb.org/ontology/core#hasPublicationVenue> ?venueURI .
        """ .

###############################################
### CREATE
###############################################

<https://vivoweb.org/procedure/create_event>
        a                        		dynapi:Procedure ;
        rdfs:label               		"Create an event"@en-US ;
        dynapi:accessWhitelist                  <https://vivoweb.org/procedure/event/access/admin> ;
        dynapi:hasFirstStep 			<https://vivoweb.org/procedure/create_event/creation_properties/step1> ;
        dynapi:providesParameter                <https://vivoweb.org/procedure/event/parameter/uri>  .

<https://vivoweb.org/procedure/create_event/creation_properties/step1>
        a                        		dynapi:OperationalStep ;
        rdfs:label               		"creation of an event step 1"@en-US ;
        dynapi:hasOperation 			<https://vivoweb.org/procedure/create_event/execute_template/n3_template_subject> ;
	dynapi:hasNextStep			<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step2> .

<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step2>
        a                                       dynapi:ConditionalStep ;
        rdfs:label                              "conditional step for event type check"@en-US ;
        dynapi:nextIfSatisfied                  <https://vivoweb.org/procedure/create_event/creation_properties/step2> ;
        dynapi:nextIfNotSatisfied               <https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step3> ;
        dynapi:hasCondition                     <https://vivoweb.org/condition/event/type_check> .

<https://vivoweb.org/procedure/create_event/creation_properties/step2>
        a                        		dynapi:OperationalStep ;
        rdfs:label               		"creation of an event step 2"@en-US ;
        dynapi:hasOperation 			<https://vivoweb.org/procedure/create_event/execute_template/n3_template_type> ;
	dynapi:hasNextStep			<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step3> .

<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step3>
        a                                       dynapi:ConditionalStep ;
        rdfs:label                              "conditional step for event name check"@en-US ;
        dynapi:nextIfSatisfied                  <https://vivoweb.org/procedure/create_event/creation_properties/step3> ;
        dynapi:nextIfNotSatisfied               <https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step4> ;
        dynapi:hasCondition                     <https://vivoweb.org/condition/event/name_check> .

<https://vivoweb.org/procedure/create_event/creation_properties/step3>
        a                        		dynapi:OperationalStep ;
        rdfs:label               		"creation of an event step 3"@en-US ;
        dynapi:hasOperation 			<https://vivoweb.org/procedure/create_event/execute_template/n3_template_name> ;
	dynapi:hasNextStep			<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step4> .

<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step4>
        a                                       dynapi:ConditionalStep ;
        rdfs:label                              "conditional step for event abbreviation check"@en-US ;
        dynapi:nextIfSatisfied                  <https://vivoweb.org/procedure/create_event/creation_properties/step4> ;
        dynapi:nextIfNotSatisfied               <https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step5> ;
        dynapi:hasCondition                     <https://vivoweb.org/condition/event/abbreviation_check> .

<https://vivoweb.org/procedure/create_event/creation_properties/step4>
        a                        		dynapi:OperationalStep ;
        rdfs:label               		"creation of an event step 4"@en-US ;
        dynapi:hasOperation 			<https://vivoweb.org/procedure/create_event/execute_template/n3_template_abbreviation> ;
	dynapi:hasNextStep			<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step5> .

<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step5>
        a                                       dynapi:ConditionalStep ;
        rdfs:label                              "conditional step for event startDate check"@en-US ;
        dynapi:nextIfSatisfied                  <https://vivoweb.org/procedure/create_event/creation_properties/step5> ;
        dynapi:nextIfNotSatisfied               <https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step6> ;
        dynapi:hasCondition                     <https://vivoweb.org/condition/event/startDate_check> .

<https://vivoweb.org/procedure/create_event/creation_properties/step5>
        a                        		dynapi:OperationalStep ;
        rdfs:label               		"creation of an event step 5"@en-US ;
        dynapi:hasOperation 			<https://vivoweb.org/procedure/create_event/execute_template/n3_template_startDate> ;
	dynapi:hasNextStep			<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step6> .

<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step6>
        a                                       dynapi:ConditionalStep ;
        rdfs:label                              "conditional step for event endDate check"@en-US ;
        dynapi:nextIfSatisfied                  <https://vivoweb.org/procedure/create_event/creation_properties/step6> ;
        dynapi:nextIfNotSatisfied               <https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step7> ;
        dynapi:hasCondition                     <https://vivoweb.org/condition/event/endDate_check> .

<https://vivoweb.org/procedure/create_event/creation_properties/step6>
        a                        		dynapi:OperationalStep ;
        rdfs:label               		"creation of an event step 6"@en-US ;
        dynapi:hasOperation 			<https://vivoweb.org/procedure/create_event/execute_template/n3_template_endDate> ;
	dynapi:hasNextStep			<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step7> .

<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step7>
        a                                       dynapi:ConditionalStep ;
        rdfs:label                              "conditional step for event place check"@en-US ;
        dynapi:nextIfSatisfied                  <https://vivoweb.org/procedure/create_event/creation_properties/step7> ;
        dynapi:nextIfNotSatisfied               <https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step8and9> ;
        dynapi:hasCondition                     <https://vivoweb.org/condition/event/place_check> .

<https://vivoweb.org/procedure/create_event/creation_properties/step7>
        a                        		dynapi:OperationalStep ;
        rdfs:label               		"creation of an event step 7"@en-US ;
        dynapi:hasOperation 			<https://vivoweb.org/procedure/create_event/execute_template/n3_template_place> ;
	dynapi:hasNextStep			<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step8and9> .

<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step8and9>
        a                                       dynapi:ConditionalStep ;
        rdfs:label                              "conditional step for event venue check"@en-US ;
        dynapi:nextIfSatisfied                  <https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step8> ;
        dynapi:hasCondition                     <https://vivoweb.org/condition/event/eventVenue_check> .

<https://vivoweb.org/procedure/create_event/creation_properties/conditional_for_step8>
        a                                       dynapi:ConditionalStep ;
        rdfs:label                              "conditional step for event venue name check"@en-US ;                                        
        dynapi:nextIfSatisfied                  <https://vivoweb.org/procedure/create_event/creation_properties/step8_unpack> ;
        dynapi:nextIfNotSatisfied               <https://vivoweb.org/procedure/create_event/creation_properties/create_eventVenue> ;
        dynapi:hasCondition                     <https://vivoweb.org/condition/event/contains_event_name_key/condition_container_contains> .

<https://vivoweb.org/procedure/create_event/creation_properties/step8_unpack>
        a                                       dynapi:OperationalStep ;
        dynapi:hasNextStep                      <https://vivoweb.org/procedure/create_event/creation_properties/create_eventVenue> ;
        dynapi:hasOperation                     <https://vivoweb.org/procedure/create_event/get_event_venue_name/operation> .

<https://vivoweb.org/procedure/create_event/creation_properties/create_eventVenue>
        a                                       dynapi:OperationalStep ;
        dynapi:hasOperation                     <https://vivoweb.org/procedure/create_event/event_venue_construct_query_fill_in/operation> .

###############################################
### READ (all)
###############################################

<https://vivoweb.org/procedure/read_events>
        a                                       dynapi:Procedure ;
        rdfs:label                              "Fetching OUs"@en-US ;
        dynapi:accessWhitelist                  <https://vivoweb.org/procedure/event/access/admin> ;
        dynapi:providesParameter                <https://vivoweb.org/ontology/event/parameter/events> ;
        dynapi:providesParameter 		<https://vivoweb.org/ontology/event/parameter/count>;
        dynapi:hasFirstStep 			<https://vivoweb.org/procedure/read_events/fetching_properties/step> .

<https://vivoweb.org/procedure/read_events/fetching_properties/step>
        a                                       dynapi:OperationalStep ;
        rdfs:label                              "fetch events step"@en-US ;
        dynapi:hasOperation 		        <https://vivoweb.org/procedure/read_events/fetching_properties/sparql_select_query> ;
        dynapi:hasNextStep			<https://vivoweb.org/procedure/read_events/statistics/step> .

<https://vivoweb.org/procedure/read_events/fetching_properties/sparql_select_query>
        a                                       dynapi:SparqlSelectQuery ;
        rdfs:label                              "read events sparql query"@en-US ;
        dynapi:hasModel 			<https://vivoweb.org/ontology/vitro-dynamic-api/model/full_union> ;
        dynapi:providesParameter 		<https://vivoweb.org/ontology/event/parameter/events> ;
        dynapi:requiresPlainParameter 	        <https://vivoweb.org/ontology/event/parameter/limit> ;
        dynapi:requiresPlainParameter           <https://vivoweb.org/ontology/event/parameter/offset> ;
        dynapi:requiresPlainParameter           <https://vivoweb.org/ontology/event/parameter/sortBy> ;
        dynapi:requiresPlainParameter           <https://vivoweb.org/ontology/event/parameter/order> ;
        dynapi:sparqlQueryText
        """
        SELECT ?uri (GROUP_CONCAT(DISTINCT ?typeOptional; separator=" -> ") as ?type) 
                    (SAMPLE(?nameOptional) as ?name)
                    (SAMPLE(?abbreviationOptional) as ?abbreviation)
                    (SAMPLE(?startDateOptional) as ?startDate)
                    (SAMPLE(?endDateOptional) as ?endDate)
                    (SAMPLE(?placeOptional) as ?place)
                    (SAMPLE(CONCAT(
                        '{"uri":"', IF(BOUND(?eventVenueURI), STR(?eventVenueURI), ''), 
                        '", "name":"', IF(BOUND(?eventVenueName), STR(?eventVenueName), ''),
                        '"}'
                        )) as ?eventVenue)
        WHERE {
            ?uri a  <http://purl.org/NET/c4dm/event.owl#Event> .
            OPTIONAL { ?uri <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#mostSpecificType> ?typeOptional }
            OPTIONAL { ?uri <http://www.w3.org/2006/vcard/ns#Name> ?nameOptional }
            OPTIONAL { ?uri <http://vivoweb.org/ontology/core#abbreviation> ?abbreviationOptional }
            OPTIONAL { ?uri <http://vivoweb.org/ontology/core#start> ?startDateOptional }
            OPTIONAL { ?uri <http://vivoweb.org/ontology/core#end> ?endDateOptional }
            OPTIONAL { ?uri <http://www.w3.org/2006/vcard/ns#Address> ?placeOptional }
            OPTIONAL {
                        ?uri <http://vivoweb.org/ontology/core#hasPublicationVenue> ?eventVenueURI .
                        OPTIONAL { ?eventVenueURI <http://www.w3.org/2006/vcard/ns#Name> ?eventVenueName }
                }
        }
        GROUP BY ?uri
        ORDER BY ?label
        LIMIT ?limit OFFSET ?offset
        """ .

<https://vivoweb.org/procedure/read_events/statistics/step>
        a                                       dynapi:OperationalStep ;
        rdfs:label                              "number of events step "@en-US ;
        dynapi:hasOperation 		        <https://vivoweb.org/procedure/read_events/statistics/sparql_query> .

<https://vivoweb.org/procedure/read_events/statistics/sparql_query>
        a                                       dynapi:SparqlSelectQuery ;
        rdfs:label                              "number of events sparql query 1"@en-US ;
        dynapi:hasModel 		        <https://vivoweb.org/ontology/vitro-dynamic-api/model/full_union> ;
        dynapi:providesParameter 	        <https://vivoweb.org/ontology/event/parameter/count> ;
        dynapi:sparqlQueryText
        """
        SELECT (count(distinct ?uri) as ?count)
            WHERE
                {
                    ?uri <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://purl.org/NET/c4dm/event.owl#Event>
                }
        """ .

###############################################
### READ (one)
###############################################

<https://vivoweb.org/procedure/read_event>
        a                                       dynapi:Procedure ;
        rdfs:label                              "Fetching an event"@en-US ;
        dynapi:accessWhitelist                  <https://vivoweb.org/procedure/event/access/admin> ;
        dynapi:providesParameter 	        <https://vivoweb.org/ontology/event/parameter/events> ;
        dynapi:hasFirstStep 		        <https://vivoweb.org/procedure/read_event/fetching_properties/step> .

<https://vivoweb.org/procedure/read_event/fetching_properties/step>
        a                        	        dynapi:OperationalStep ;
        rdfs:label               	        "reading of an event"@en-US ;
        dynapi:hasOperation 		        <https://vivoweb.org/procedure/read_event/fetching_properties/sparql_query> .

<https://vivoweb.org/procedure/read_event/fetching_properties/sparql_query>
        a                                       dynapi:SparqlSelectQuery ;
        rdfs:label                              "read event sparql query"@en-US ;
        dynapi:hasModel 		        <https://vivoweb.org/ontology/vitro-dynamic-api/model/full_union> ;
        dynapi:requiresParameter 	        <https://vivoweb.org/procedure/event/parameter/resource_id> ;
        dynapi:providesParameter 	        <https://vivoweb.org/ontology/event/parameter/events> ;
        dynapi:sparqlQueryText
        """
        SELECT ?uri (GROUP_CONCAT(DISTINCT ?typeOptional; separator=" -> ") as ?type) 
                    (SAMPLE(?nameOptional) as ?name)
                    (SAMPLE(?abbreviationOptional) as ?abbreviation)
                    (SAMPLE(?startDateOptional) as ?startDate)
                    (SAMPLE(?endDateOptional) as ?endDate)
                    (SAMPLE(?placeOptional) as ?place)
                    (SAMPLE(CONCAT(
                        '{"uri":"', IF(BOUND(?eventVenueURI), STR(?eventVenueURI), ''), 
                        '", "name":"', IF(BOUND(?eventVenueName), STR(?eventVenueName), ''),
                        '"}'
                        )) as ?eventVenue)
        WHERE {
                ?uri a  <http://purl.org/NET/c4dm/event.owl#Event> .
                OPTIONAL { ?uri <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#mostSpecificType> ?typeOptional }
                OPTIONAL { ?uri <http://www.w3.org/2006/vcard/ns#Name> ?nameOptional }
                OPTIONAL { ?uri <http://vivoweb.org/ontology/core#abbreviation> ?abbreviationOptional }
                OPTIONAL { ?uri <http://vivoweb.org/ontology/core#start> ?startDateOptional }
                OPTIONAL { ?uri <http://vivoweb.org/ontology/core#end> ?endDateOptional }
                OPTIONAL { ?uri <http://www.w3.org/2006/vcard/ns#Address> ?placeOptional }
                OPTIONAL {
                                ?uri <http://vivoweb.org/ontology/core#hasPublicationVenue> ?eventVenueURI .
                                OPTIONAL { ?eventVenueURI <http://www.w3.org/2006/vcard/ns#Name> ?eventVenueName }
                        }
                FILTER( ?uri = ?resource_id)
        }
        GROUP BY ?uri
        """ .

###############################################
### DELETE
###############################################

<https://vivoweb.org/procedure/delete_event>
        a                                       dynapi:Procedure ;
        rdfs:label                              "Deleting a OU"@en-US ;
        dynapi:accessWhitelist                  <https://vivoweb.org/procedure/event/access/admin> ;
        dynapi:hasFirstStep                     <https://vivoweb.org/procedure/delete_event/get_event_from_dynamic_api_graph/step> .

<https://vivoweb.org/procedure/delete_event/get_event_from_dynamic_api_graph/step>
        a                                       dynapi:OperationalStep ;
        dynapi:hasNextStep                      <https://vivoweb.org/procedure/delete_event/remove_from_dynamic_api_model/step> ;
        dynapi:hasOperation                     <https://vivoweb.org/procedure/delete_event/get_event_from_dynamic_api_graph/operation> .

<https://vivoweb.org/procedure/delete_event/get_event_from_dynamic_api_graph/operation>
         a                                      dynapi:SparqlConstructQuery ;
         dynapi:sparqlQueryText              """
         prefix dynapi: <https://vivoweb.org/ontology/vitro-dynamic-api#>
         prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
         prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#>
         prefix xsd: <http://www.w3.org/2001/XMLSchema#>
         CONSTRUCT { 
                 ?resource_id 
                 rdf:type <http://purl.org/NET/c4dm/event.owl#Event> ;
                 <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#mostSpecificType> ?type ;
                 <http://www.w3.org/2006/vcard/ns#Name> ?name ;
                 <http://vivoweb.org/ontology/core#abbreviation> ?abbreviation ;
                 <http://vivoweb.org/ontology/core#start> ?startDate ;
                 <http://vivoweb.org/ontology/core#end> ?endDate ;
                 <http://www.w3.org/2006/vcard/ns#Address> ?place ;
                 <http://vivoweb.org/ontology/core#hasPublicationVenue> ?eventVenueURI .

                 ?eventVenueURI
                 rdf:type <http://www.w3.org/2006/vcard/ns#Individual> ;
                 <http://www.w3.org/2006/vcard/ns#Name> ?eventVenueName .
                 
         } WHERE {
                ?resource_id a <http://purl.org/NET/c4dm/event.owl#Event> .
                OPTIONAL { ?uri <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#mostSpecificType> ?typeOptional }
                OPTIONAL { ?uri <http://www.w3.org/2006/vcard/ns#Name> ?nameOptional }
                OPTIONAL { ?uri <http://vivoweb.org/ontology/core#abbreviation> ?abbreviationOptional }
                OPTIONAL { ?uri <http://vivoweb.org/ontology/core#start> ?startDateOptional }
                OPTIONAL { ?uri <http://vivoweb.org/ontology/core#end> ?endDateOptional }
                OPTIONAL { ?uri <http://www.w3.org/2006/vcard/ns#Address> ?placeOptional }
                OPTIONAL {
                                ?resource_id <http://vivoweb.org/ontology/core#hasPublicationVenue> ?eventVenueURI .
                                OPTIONAL { ?eventVenueURI <http://www.w3.org/2006/vcard/ns#Name> ?eventVenueName }
                        }
         } 
         """ ;
         dynapi:providesParameter               <https://vivoweb.org/procedure/delete_event/parameter/event_graph> ;
         dynapi:requiresParameter               <https://vivoweb.org/procedure/event/parameter/resource_id> ;
         dynapi:hasModel                        <https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> .

<https://vivoweb.org/procedure/delete_event/remove_from_dynamic_api_model/step>
        a                                       dynapi:OperationalStep ;
        dynapi:hasNextStep                      <https://vivoweb.org/procedure/delete_event/unload_procedure_from_procedure_pool/step> ;
        dynapi:hasOperation                     <https://vivoweb.org/procedure/delete_event/remove_from_dynamic_api_model/operation> .

<https://vivoweb.org/procedure/delete_event/remove_from_dynamic_api_model/operation>
        a                                       dynapi:ModelWriter ;
        dynapi:retractionModel                  <https://vivoweb.org/procedure/delete_event/parameter/event_graph> ;
        dynapi:targetModel                      <https://vivoweb.org/ontology/vitro-dynamic-api/model/abox_assertions> .

<https://vivoweb.org/procedure/delete_event/unload_procedure_from_procedure_pool/step>
        a                                       dynapi:OperationalStep ;
        dynapi:hasOperation                     <https://vivoweb.org/procedure/delete_event/unload_procedure_from_procedure_pool/operation> .

<https://vivoweb.org/procedure/delete_event/unload_procedure_from_procedure_pool/operation>
        a                                       dynapi:ProcedurePoolAtomicOperation ;
        dynapi:poolOperationType                "unload" ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/resource_id> .

##########################
## Unpacking operations ##
##########################

<https://vivoweb.org/procedure/create_event/get_event_venue_name/operation>
        a                                       dynapi:ContainerQuery ;
        dynapi:targetContainer                  <https://vivoweb.org/procedure/event/parameter/eventVenue> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/create_event/parameter/eventVenueName_key> ;
        dynapi:providesParameter                <https://vivoweb.org/procedure/event/parameter/venueName> .

###############################################
### PARAMETERS
###############################################

####################
## Event response ##
####################

<https://vivoweb.org/ontology/event/parameter/events>
        a                                       dynapi:Parameter ;
        rdfs:label                              "events"@en-US ;
        dynapi:name                             "events" ;
        dynapi:description                      "List of available events and statistics (number)" ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainerArray> .

<https://vivoweb.org/ontology/event/parameter/count>
        a                                       dynapi:Parameter ;
        rdfs:label                              "Number of fetched events"@en-US ;
        dynapi:name                             "count" ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainer> .

#####################
## Creation fields ##
#####################

<https://vivoweb.org/procedure/event/parameter/uri>
        a                                       dynapi:Parameter ;
        dynapi:name                             "uri" ;
        dynapi:defaultValue                     "http://purl.org/NET/c4dm/event.owl/Event#,java_uuid_number" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/event/parameter/type>
        a                                       dynapi:Parameter ;
        dynapi:name                             "type" ;
        dynapi:defaultValue                     "" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/uri> .

<https://vivoweb.org/procedure/event/parameter/name>
        a                                       dynapi:Parameter ;
        dynapi:name                             "name" ;
        dynapi:defaultValue                     "" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

<https://vivoweb.org/procedure/event/parameter/abbreviation>
        a                                       dynapi:Parameter ;
        dynapi:name                             "abbreviation" ;
        dynapi:defaultValue                     "" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

<https://vivoweb.org/procedure/event/parameter/startDate>
        a                                       dynapi:Parameter ;
        dynapi:name                             "startDate" ;
        dynapi:defaultValue                     "" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

<https://vivoweb.org/procedure/event/parameter/endDate>
        a                                       dynapi:Parameter ;
        dynapi:name                             "endDate" ;
        dynapi:defaultValue                     "" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

<https://vivoweb.org/procedure/event/parameter/place>
        a                                       dynapi:Parameter ;
        dynapi:name                             "place" ;
        dynapi:defaultValue                     "" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

<https://vivoweb.org/procedure/event/parameter/eventVenue>
        a                                       dynapi:Parameter ;
        dynapi:name                             "eventVenue" ;
        dynapi:defaultValue                     "{}" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainer> .

<https://vivoweb.org/procedure/event/parameter/venueURI>
        a                                       dynapi:Parameter ;
        dynapi:name                             "venueURI" ;
        dynapi:defaultValue                     "http://www.w3.org/2006/vcard/ns/Individual#,java_uuid_number" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/event/parameter/venueName>
        a                                       dynapi:Parameter ;
        dynapi:name                             "venueName" ;
        dynapi:defaultValue                     "" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

# Event Venue keys

<https://vivoweb.org/procedure/create_event/parameter/eventVenueName_key>
        a                                       dynapi:Parameter ;
        dynapi:name                             "eventVenueName_key" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:defaultValue                     "name" ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string> .

#########################
## Read request fields ##
#########################

<https://vivoweb.org/procedure/event/parameter/resource_id>
        a                                       dynapi:Parameter ;
        dynapi:name                             "resource_id" ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/uri> ;
        rdfs:label                              "resource uri"@en-US .

<https://vivoweb.org/ontology/event/parameter/total>
        a                                       dynapi:parameter ;
        dynapi:name                             "total" ;
        dynapi:hasType 		                <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/integer> ;
        rdfs:label                              "total"@en-US .

<https://vivoweb.org/ontology/event/parameter/limit>
        a                                       dynapi:parameter ;
        dynapi:name                             "limit" ;
        dynapi:defaultValue                     "20" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType 		                <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/integer> ;
        rdfs:label                              "limit"@en-US .

<https://vivoweb.org/ontology/event/parameter/offset>
        a                                       dynapi:parameter ;
        dynapi:name                             "offset" ;
        dynapi:defaultValue                     "0" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/integer> ;
        rdfs:label                              "offset"@en-US .

<https://vivoweb.org/ontology/event/parameter/sortBy>
        a                                       dynapi:parameter ;
        dynapi:name                             "sortBy" ;
        dynapi:defaultValue                     "label" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType 		                <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string> ;
        rdfs:label                              "sortBy"@en-US .

<https://vivoweb.org/ontology/event/parameter/order>
        a                                       dynapi:parameter ;
        dynapi:name                             "order" ;
        dynapi:defaultValue                     "ASC" ;
        dynapi:isInternal                       "true"^^xsd:boolean ;
        dynapi:isOptionalParam                  "true"^^xsd:boolean ;
        dynapi:hasType 		                <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string> ;
        rdfs:label                              "order"@en-US .

###########################
## Delete request fields ##
###########################

<https://vivoweb.org/procedure/delete_event/parameter/event_graph>
        a                                       dynapi:Model ;
        dynapi:name                             "event_graph" ;
        dynapi:hasType                          <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/model> .

###############################################
### PARAMETER CHECKS
###############################################

<https://vivoweb.org/condition/event/type_check>
        a                                       dynapi:ConditionIsNotEmpty ;
        rdfs:label                              "condition if event type is defined"@en-US ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/type> .

<https://vivoweb.org/condition/event/name_check>
        a                                       dynapi:ConditionIsNotEmpty ;
        rdfs:label                              "condition if event name is defined"@en-US ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/name> .

<https://vivoweb.org/condition/event/abbreviation_check>
        a                                       dynapi:ConditionIsNotEmpty ;
        rdfs:label                              "condition if event abbreviation is defined"@en-US ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/abbreviation> .

<https://vivoweb.org/condition/event/startDate_check>
        a                                       dynapi:ConditionIsNotEmpty ;
        rdfs:label                              "condition if event startDate is defined"@en-US ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/startDate> .

<https://vivoweb.org/condition/event/endDate_check>
        a                                       dynapi:ConditionIsNotEmpty ;
        rdfs:label                              "condition if event endDate is defined"@en-US ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/endDate> .

<https://vivoweb.org/condition/event/place_check>
        a                                       dynapi:ConditionIsNotEmpty ;
        rdfs:label                              "condition if event place is defined"@en-US ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/place> .

<https://vivoweb.org/condition/event/eventVenue_check>
        a                                       dynapi:ConditionIsNotEmpty ;
        rdfs:label                              "condition if event venue is defined"@en-US ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/event/parameter/eventVenue> .

<https://vivoweb.org/condition/event/contains_event_name_key/condition_container_contains>
        a                                       dynapi:ConditionContainerContains ;
        dynapi:targetContainer                  <https://vivoweb.org/procedure/event/parameter/eventVenue> ;
        dynapi:requiresParameter                <https://vivoweb.org/procedure/create_event/parameter/eventVenueName_key> .

###############################################
### ACCESS CONTROL
###############################################

<https://vivoweb.org/procedure/event/access/admin>
        a                                       dynapi:GroupAccessWhitelist ;
        dynapi:userGroup                        <https://vivoweb.org/ontology/vitro-dynamic-api/user-group/admin> .
